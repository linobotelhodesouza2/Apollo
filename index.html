<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Produtos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 15px;
        }
        @media (min-width: 768px) {
            .app-container {
                max-width: 750px;
            }
        }
        .product-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        .form-control, .form-select, .btn {
            border-radius: 8px;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        #produtoDetalhes {
            display: none;
        }
        .comment-list {
            max-height: 300px;
            overflow-y: auto;
        }
        #successMessage {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="app-container mt-4">
        <h2 class="mb-4 text-center">App de Gerenciamento de Produtos</h2>
        <div id="successMessage" class="alert alert-success" role="alert">
            Dados salvos com sucesso!
        </div>
        <form id="produtoForm" class="mb-4">
            <div class="row mb-3">
                <div class="col">
                    <input type="text" class="form-control" id="produto" placeholder="Produto" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <input type="number" class="form-control" id="perimetro" placeholder="Perímetro" required>
                </div>
                <div class="col">
                    <input type="text" class="form-control" id="corte" placeholder="Corte" required>
                </div>
                <div class="col">
                    <select class="form-select" id="chagrim">
                        <option value="">Chagrim</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <input type="number" class="form-control" id="repeticao" placeholder="Repetição" required>
                </div>
                <div class="col">
                    <input type="number" class="form-control" id="velocidade" placeholder="Velocidade" required>
                </div>
                <div class="col">
                    <input type="file" class="form-control" id="imagemProduto" accept="image/jpeg">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <textarea class="form-control" id="comentario" rows="3" placeholder="Comentário"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button type="submit" class="btn btn-primary w-100">Salvar Dados</button>
                </div>
            </div>
        </form>

        <div class="dropdown mb-3">
            <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                Produtos Salvos
            </button>
            <ul class="dropdown-menu w-100" id="produtosSalvos" aria-labelledby="dropdownMenuButton">
            </ul>
        </div>

        <div id="produtoDetalhes" class="mt-4">
            <h3>Detalhes do Produto</h3>
            <div class="row">
                <div class="col-md-8">
                    <p><strong>Produto:</strong> <span id="detNome"></span></p>
                    <p><strong>Perímetro:</strong> <span id="detPerimetro"></span></p>
                    <p><strong>Corte:</strong> <input type="text" id="detCorte" class="form-control"></p>
                    <p><strong>Chagrim:</strong> <span id="detChagrim"></span></p>
                    <p><strong>Repetição:</strong> <span id="detRepeticao"></span></p>
                    <p><strong>Velocidade:</strong> <input type="number" id="detVelocidade" class="form-control"></p>
                    <button id="salvarEdicao" class="btn btn-primary mt-2">Salvar Edição</button>
                    <button id="excluirProduto" class="btn btn-danger mt-2 ms-2">Excluir Produto</button>
                </div>
                <div class="col-md-4">
                    <img id="detImagem" src="" alt="Imagem do Produto" class="product-image">
                </div>
            </div>
            <div class="mt-4">
                <h4>Comentários</h4>
                <div id="comentariosList" class="comment-list mb-3"></div>
                <form id="novoComentarioForm">
                    <div class="mb-3">
                        <textarea class="form-control" id="novoComentario" rows="3" placeholder="Adicionar novo comentário" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Comentário</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let produtoAtual = null;
        let produtoIndex = null;

        document.getElementById('produtoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const imageFile = document.getElementById('imagemProduto').files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const produto = {
                    nome: document.getElementById('produto').value,
                    perimetro: document.getElementById('perimetro').value,
                    corte: document.getElementById('corte').value,
                    chagrim: document.getElementById('chagrim').value,
                    repeticao: document.getElementById('repeticao').value,
                    velocidade: document.getElementById('velocidade').value,
                    imagem: event.target.result,
                    comentarios: []
                };

                const comentario = document.getElementById('comentario').value;
                if (comentario) {
                    produto.comentarios.push({
                        texto: comentario,
                        data: new Date().toLocaleString()
                    });
                }

                let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
                produtos.push(produto);
                localStorage.setItem('produtos', JSON.stringify(produtos));

                atualizarMenuSuspenso();
                limparCampos();
                mostrarMensagemSucesso();
            };

            if (imageFile) {
                reader.readAsDataURL(imageFile);
            } else {
                reader.onload({ target: { result: null } });
            }
        });

        function limparCampos() {
            document.getElementById('produtoForm').reset();
            document.getElementById('imagemProduto').value = '';
        }

        function mostrarMensagemSucesso() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function atualizarMenuSuspenso() {
            const produtos = JSON.parse(localStorage.getItem('produtos')) || [];
            const dropdownMenu = document.getElementById('produtosSalvos');
            dropdownMenu.innerHTML = '';

            if (produtos.length === 0) {
                const li = document.createElement('li');
                li.innerHTML = '<span class="dropdown-item">Nenhum produto salvo</span>';
                dropdownMenu.appendChild(li);
            } else {
                produtos.forEach((produto, index) => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.classList.add('dropdown-item');
                    a.href = '#';
                    a.textContent = produto.nome;
                    a.onclick = () => mostrarDetalhes(index);
                    li.appendChild(a);
                    dropdownMenu.appendChild(li);
                });
            }
        }

        function mostrarDetalhes(index) {
            const produtos = JSON.parse(localStorage.getItem('produtos')) || [];
            produtoAtual = produtos[index];
            produtoIndex = index;
            
            document.getElementById('detNome').textContent = produtoAtual.nome;
            document.getElementById('detPerimetro').textContent = produtoAtual.perimetro;
            document.getElementById('detCorte').value = produtoAtual.corte;
            document.getElementById('detChagrim').textContent = produtoAtual.chagrim;
            document.getElementById('detRepeticao').textContent = produtoAtual.repeticao;
            document.getElementById('detVelocidade').value = produtoAtual.velocidade;
            document.getElementById('detImagem').src = produtoAtual.imagem || '/api/placeholder/200/200';
            
            atualizarComentarios();
            
            document.getElementById('produtoDetalhes').style.display = 'block';
        }

        document.getElementById('salvarEdicao').addEventListener('click', function() {
            produtoAtual.corte = document.getElementById('detCorte').value;
            produtoAtual.velocidade = document.getElementById('detVelocidade').value;

            let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
            produtos[produtoIndex] = produtoAtual;
            localStorage.setItem('produtos', JSON.stringify(produtos));

            mostrarMensagemSucesso();
        });

        document.getElementById('excluirProduto').addEventListener('click', function() {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
                produtos.splice(produtoIndex, 1);
                localStorage.setItem('produtos', JSON.stringify(produtos));

                document.getElementById('produtoDetalhes').style.display = 'none';
                atualizarMenuSuspenso();
                mostrarMensagemSucesso();
            }
        });

        function atualizarComentarios() {
            const comentariosList = document.getElementById('comentariosList');
            comentariosList.innerHTML = '';
            produtoAtual.comentarios.forEach(comentario => {
                const comentarioElement = document.createElement('div');
                comentarioElement.classList.add('mb-2');
                comentarioElement.innerHTML = `
                    <small class="text-muted">${comentario.data}</small>
                    <p class="mb-1">${comentario.texto}</p>
                `;
                comentariosList.appendChild(comentarioElement);
            });
        }

        document.getElementById('novoComentarioForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const novoComentario = document.getElementById('novoComentario').value;
            if (novoComentario && produtoAtual) {
                produtoAtual.comentarios.push({
                    texto: novoComentario,
                    data: new Date().toLocaleString()
                });

                let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
                produtos[produtoIndex] = produtoAtual;
                localStorage.setItem('produtos', JSON.stringify(produtos));

                atualizarComentarios();
                this.reset();
            }
        });

        atualizarMenuSuspenso();
    </script>
</body>
</html>
