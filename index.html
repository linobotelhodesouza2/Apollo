<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Produtos</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 30px;
        }
        #produtoDetalhes {
            display: none;
            margin-top: 20px;
        }
        .comment-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        #successMessage {
            display: none;
            color: green;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerenciamento de Produtos</h1>

        <form id="produtoForm">
            <div class="form-group">
                <label for="produtoNome">Nome do Produto:</label>
                <input type="text" class="form-control" id="produtoNome" required>
            </div>
            <div class="form-group">
                <label for="produtoPerimetro">Perímetro:</label>
                <input type="text" class="form-control" id="produtoPerimetro" required>
            </div>
            <div class="form-group">
                <label for="produtoCorte">Corte:</label>
                <input type="text" class="form-control" id="produtoCorte" required>
            </div>
            <div class="form-group">
                <label for="produtoChagrim">Chagrim:</label>
                <input type="text" class="form-control" id="produtoChagrim" required>
            </div>
            <div class="form-group">
                <label for="produtoRepeticao">Repetição:</label>
                <input type="text" class="form-control" id="produtoRepeticao" required>
            </div>
            <div class="form-group">
                <label for="produtoVelocidade">Velocidade:</label>
                <input type="text" class="form-control" id="produtoVelocidade" required>
            </div>
            <div class="form-group">
                <label for="imagemProduto">Imagem do Produto:</label>
                <input type="file" class="form-control-file" id="imagemProduto" accept="image/*">
            </div>
            <button type="submit" class="btn btn-primary">Salvar Produto</button>
            <button type="button" id="limparCampos" class="btn btn-secondary">Limpar Campos</button>
            <div id="successMessage">Produto salvo com sucesso!</div>
        </form>

        <hr>

        <h2>Produtos Salvos</h2>
        <ul id="produtosSalvos" class="dropdown-menu"></ul>

        <div id="produtoDetalhes">
            <h3>Detalhes do Produto</h3>
            <p><strong>Nome:</strong> <span id="detNome"></span></p>
            <p><strong>Perímetro:</strong> <span id="detPerimetro"></span></p>
            <p><strong>Corte:</strong> <input type="text" id="detCorte" class="form-control"></p>
            <p><strong>Chagrim:</strong> <span id="detChagrim"></span></p>
            <p><strong>Repetição:</strong> <span id="detRepeticao"></span></p>
            <p><strong>Velocidade:</strong> <input type="text" id="detVelocidade" class="form-control"></p>
            <img id="detImagem" src="" alt="Imagem do Produto" class="img-thumbnail">

            <h4>Comentários</h4>
            <div id="comentariosList"></div>

            <form id="novoComentarioForm">
                <div class="form-group">
                    <label for="novoComentario">Adicionar Comentário:</label>
                    <textarea class="form-control" id="novoComentario" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Adicionar Comentário</button>
            </form>

            <br>
            <button id="salvarEdicao" class="btn btn-success">Salvar Alterações</button>
            <button id="excluirProduto" class="btn btn-danger">Excluir Produto</button>
        </div>
    </div>

    <!-- Firebase and other scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB0DfSwB68tf7FagfGSLyOszQRduYoGiak",
            authDomain: "lino-29b0b.firebaseapp.com",
            databaseURL: "https://lino-29b0b-default-rtdb.firebaseio.com",
            projectId: "lino-29b0b",
            storageBucket: "lino-29b0b.appspot.com",
            messagingSenderId: "731949645073",
            appId: "1:731949645073:web:4eaf9011174f08473ee0b0"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let produtoAtual = null;
        let produtoIndex = null;

        document.getElementById('produtoForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const nome = document.getElementById('produtoNome').value;
            const perimetro = document.getElementById('produtoPerimetro').value;
            const corte = document.getElementById('produtoCorte').value;
            const chagrim = document.getElementById('produtoChagrim').value;
            const repeticao = document.getElementById('produtoRepeticao').value;
            const velocidade = document.getElementById('produtoVelocidade').value;
            const imagemFile = document.getElementById('imagemProduto').files[0];

            let produto = {
                nome: nome,
                perimetro: perimetro,
                corte: corte,
                chagrim: chagrim,
                repeticao: repeticao,
                velocidade: velocidade,
                imagem: '',
                comentarios: []
            };

            // Salvar imagem se selecionada
            const reader = new FileReader();
            reader.onload = function(event) {
                produto.imagem = event.target.result;

                // Salvar produto no Realtime Database
                const novoProdutoRef = database.ref('produtos').push();
                novoProdutoRef.set(produto);

                atualizarMenuSuspenso();
                limparCampos();
                mostrarMensagemSucesso();
            };
            if (imagemFile) {
                reader.readAsDataURL(imagemFile);
            } else {
                reader.onload({target: {result: ''}});
            }
        });

        function atualizarMenuSuspenso() {
            database.ref('produtos').once('value', function(snapshot) {
                const produtosSalvos = document.getElementById('produtosSalvos');
                produtosSalvos.innerHTML = '';

                snapshot.forEach(function(childSnapshot) {
                    const key = childSnapshot.key;
                    const produto = childSnapshot.val();

                    const li = document.createElement('li');
                    li.className = 'dropdown-item';
                    li.innerText = produto.nome;
                    li.addEventListener('click', function() {
                        exibirDetalhesProduto(key, produto);
                    });
                    produtosSalvos.appendChild(li);
                });
            });
        }

        function exibirDetalhesProduto(key, produto) {
            produtoAtual = produto;
            produtoIndex = key;

            document.getElementById('detNome').innerText = produto.nome;
            document.getElementById('detPerimetro').innerText = produto.perimetro;
            document.getElementById('detCorte').value = produto.corte;
            document.getElementById('detChagrim').innerText = produto.chagrim;
            document.getElementById('detRepeticao').innerText = produto.repeticao;
            document.getElementById('detVelocidade').value = produto.velocidade;
            document.getElementById('detImagem').src = produto.imagem;

            const comentariosList = document.getElementById('comentariosList');
            comentariosList.innerHTML = '';

            produto.comentarios.forEach(function(comentario, index) {
                const div = document.createElement('div');
                div.className = 'comment-item';
                div.innerHTML = `<strong>Comentário ${index + 1}:</strong> ${comentario.texto} <em>(${comentario.data})</em>`;
                comentariosList.appendChild(div);
            });

            document.getElementById('produtoDetalhes').style.display = 'block';
        }

        document.getElementById('novoComentarioForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const novoComentarioTexto = document.getElementById('novoComentario').value;
            const dataAtual = new Date().toLocaleString();

            const novoComentario = {
                texto: novoComentarioTexto,
                data: dataAtual
            };

            if (produtoAtual.comentarios) {
                produtoAtual.comentarios.push(novoComentario);
            } else {
                produtoAtual.comentarios = [novoComentario];
            }

            database.ref('produtos/' + produtoIndex).update(produtoAtual);
            exibirDetalhesProduto(produtoIndex, produtoAtual);
            document.getElementById('novoComentario').value = '';
        });

        document.getElementById('salvarEdicao').addEventListener('click', function() {
            const corteEditado = document.getElementById('detCorte').value;
            const velocidadeEditada = document.getElementById('detVelocidade').value;

            produtoAtual.corte = corteEditado;
            produtoAtual.velocidade = velocidadeEditada;

            database.ref('produtos/' + produtoIndex).update(produtoAtual);
            alert('Alterações salvas com sucesso!');
        });

        document.getElementById('excluirProduto').addEventListener('click', function() {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                database.ref('produtos/' + produtoIndex).remove();
                document.getElementById('produtoDetalhes').style.display = 'none';
                atualizarMenuSuspenso();
                alert('Produto excluído com sucesso!');
            }
        });

        document.getElementById('limparCampos').addEventListener('click', limparCampos);

        function limparCampos() {
            document.getElementById('produtoForm').reset();
            document.getElementById('imagemProduto').value = '';
        }

        function mostrarMensagemSucesso() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(function() {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // Atualizar menu suspenso ao carregar a página
        atualizarMenuSuspenso();
    </script>
</body>
</html>
