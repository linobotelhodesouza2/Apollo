<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Gerenciamento de Produtos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .product-image {
            max-width: 100%;
            height: auto;
        }
        .comment-list {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="app-container container mt-4">
        <h2 id="app-de-gerenciamento-de-produtos" class="mb-4 text-center">App de Gerenciamento de Produtos</h2>

        <div id="successMessage" class="alert alert-success" role="alert" style="display: none;">
            Dados salvos com sucesso!
        </div>

        <div class="row mb-3">
            <div class="col">
                <input type="text" id="nome" class="form-control" placeholder="Nome do Produto">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col">
                <input type="number" id="perimetro" class="form-control" placeholder="Perímetro">
            </div>
            <div class="col">
                <input type="text" id="corte" class="form-control" placeholder="Corte">
            </div>
            <div class="col">
                Chagrim 
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="chagrim" id="chagrimSim" value="Sim">
                    <label class="form-check-label" for="chagrimSim">Sim</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="chagrim" id="chagrimNao" value="Não">
                    <label class="form-check-label" for="chagrimNao">Não</label>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col">
                <input type="number" id="repeticao" class="form-control" placeholder="Repetição">
            </div>
            <div class="col">
                <input type="number" id="velocidade" class="form-control" placeholder="Velocidade">
            </div>
            <div class="col">
                <input type="file" id="imagem" class="form-control" accept="image/*">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col">
                <button id="salvarDados" class="btn btn-primary">Salvar Dados</button>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="dropdown mb-3">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownProdutos" data-bs-toggle="dropdown" aria-expanded="false">
                        Produtos Salvos
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownProdutos" id="listaProdutos">
                    </ul>
                </div>
            </div>
        </div>

        <div id="produtoDetalhes" class="mt-4" style="display: none;">
            <h3>Detalhes do Produto</h3>
            <div class="row">
                <div class="col-md-8">
                    <p><strong>Produto:</strong> <span id="detNome"></span></p>
                    <p><strong>Perímetro:</strong> <span id="detPerimetro"></span></p>
                    <p><strong>Corte:</strong> <span id="detCorte"></span></p>
                    <p><strong>Chagrim:</strong> <span id="detChagrim"></span></p>
                    <p><strong>Repetição:</strong> <span id="detRepeticao"></span></p>
                    <p><strong>Velocidade:</strong> <span id="detVelocidade"></span></p>
                    <button id="salvarEdicao" class="btn btn-primary">Salvar Edição</button>
                    <button id="excluirProduto" class="btn btn-danger">Excluir Produto</button>
                </div>
                <div class="col-md-4">
                    <img id="detImagem" src="" alt="Imagem do Produto" class="product-image">
                </div>
            </div>

            <div class="mt-4">
                <h4>Comentários</h4>
                <div id="comentariosList" class="comment-list mb-3"></div>
                <div class="mb-3">
                    <textarea id="novoComentario" class="form-control" rows="3" placeholder="Digite seu comentário"></textarea>
                </div>
                <button id="adicionarComentario" class="btn btn-secondary">Adicionar Comentário</button>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col">
                <button id="voltarLogin" class="btn btn-warning">Voltar para Login</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let inactivityTimer;
        const inactivityTimeout = 5 * 60 * 1000;
        let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
        let produtoAtual = null;

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(voltarParaLogin, inactivityTimeout);
        }

        function voltarParaLogin() {
            window.location.href = 'login.html';
        }

        function salvarDados() {
            const nome = document.getElementById('nome').value;
            const perimetro = document.getElementById('perimetro').value;
            const corte = document.getElementById('corte').value;
            const chagrim = document.querySelector('input[name="chagrim"]:checked')?.value || '';
            const repeticao = document.getElementById('repeticao').value;
            const velocidade = document.getElementById('velocidade').value;
            const imagem = document.getElementById('imagem').files[0];

            const produto = {
                id: Date.now(),
                nome,
                perimetro,
                corte,
                chagrim,
                repeticao,
                velocidade,
                comentarios: []
            };

            if (imagem) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    produto.imagem = e.target.result;
                    finalizarSalvamento(produto);
                };
                reader.readAsDataURL(imagem);
            } else {
                finalizarSalvamento(produto);
            }
        }

        function finalizarSalvamento(produto) {
            produtos.push(produto);
            localStorage.setItem('produtos', JSON.stringify(produtos));
            atualizarListaProdutos();
            limparFormulario();
            mostrarMensagemSucesso();
        }

        function atualizarListaProdutos() {
            const lista = document.getElementById('listaProdutos');
            lista.innerHTML = '';
            produtos.forEach(produto => {
                const li = document.createElement('li');
                li.innerHTML = `<a class="dropdown-item" href="#" data-id="${produto.id}">${produto.nome}</a>`;
                li.querySelector('a').addEventListener('click', () => mostrarDetalhes(produto.id));
                lista.appendChild(li);
            });
        }

        function limparFormulario() {
            document.getElementById('nome').value = '';
            document.getElementById('perimetro').value = '';
            document.getElementById('corte').value = '';
            document.querySelectorAll('input[name="chagrim"]').forEach(radio => radio.checked = false);
            document.getElementById('repeticao').value = '';
            document.getElementById('velocidade').value = '';
            document.getElementById('imagem').value = '';
        }

        function mostrarMensagemSucesso() {
            const message = document.getElementById('successMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        function mostrarDetalhes(id) {
            produtoAtual = produtos.find(p => p.id === id);
            if (produtoAtual) {
                document.getElementById('detNome').textContent = produtoAtual.nome;
                document.getElementById('detPerimetro').textContent = produtoAtual.perimetro;
                document.getElementById('detCorte').textContent = produtoAtual.corte;
                document.getElementById('detChagrim').textContent = produtoAtual.chagrim;
                document.getElementById('detRepeticao').textContent = produtoAtual.repeticao;
                document.getElementById('detVelocidade').textContent = produtoAtual.velocidade;
                document.getElementById('detImagem').src = produtoAtual.imagem || '';
                atualizarComentarios();
                document.getElementById('produtoDetalhes').style.display = 'block';
            }
        }

        function salvarEdicao() {
            if (produtoAtual) {
                produtoAtual.nome = document.getElementById('detNome').textContent;
                produtoAtual.perimetro = document.getElementById('detPerimetro').textContent;
                produtoAtual.corte = document.getElementById('detCorte').textContent;
                produtoAtual.chagrim = document.getElementById('detChagrim').textContent;
                produtoAtual.repeticao = document.getElementById('detRepeticao').textContent;
                produtoAtual.velocidade = document.getElementById('detVelocidade').textContent;

                const index = produtos.findIndex(p => p.id === produtoAtual.id);
                produtos[index] = produtoAtual;
                localStorage.setItem('produtos', JSON.stringify(produtos));
                atualizarListaProdutos();
                mostrarMensagemSucesso();
            }
        }

        function excluirProduto() {
            if (produtoAtual) {
                produtos = produtos.filter(p => p.id !== produtoAtual.id);
                localStorage.setItem('produtos', JSON.stringify(produtos));
                atualizarListaProdutos();
                document.getElementById('produtoDetalhes').style.display = 'none';
                mostrarMensagemSucesso();
            }
        }

        function adicionarComentario() {
            if (produtoAtual) {
                const comentario = document.getElementById('novoComentario').value;
                if (comentario) {
                    produtoAtual.comentarios.push({
                        texto: comentario,
                        data: new Date().toLocaleString()
                    });
                    localStorage.setItem('produtos', JSON.stringify(produtos));
                    atualizarComentarios();
                    document.getElementById('novoComentario').value = '';
                }
            }
        }

        function atualizarComentarios() {
            const comentariosList = document.getElementById('comentariosList');
            comentariosList.innerHTML = '';
            produtoAtual.comentarios.forEach(comentario => {
                const div = document.createElement('div');
                div.textContent = `${comentario.data}: ${comentario.texto}`;
                comentariosList.appendChild(div);
            });
        }

        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.getElementById('voltarLogin').addEventListener('click', voltarParaLogin);
        document.getElementById('salvarDados').addEventListener('click', salvarDados);
        document.getElementById('salvarEdicao').addEventListener('click', salvarEdicao);
        document.getElementById('excluirProduto').addEventListener('click', excluirProduto);
        document.getElementById('adicionarComentario').addEventListener('click', adicionarComentario);

        atualizarListaProdutos();
        resetInactivityTimer();
    </script>
</body>
</html>